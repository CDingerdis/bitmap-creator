let unicodeList={};function selectCanvas(e){if(console.log(`id: ${e}`),!document.querySelector("#canvas"+e)){let n=document.createElement("div");n.classList=["canvasBlock d-grid"];let o=document.createElement("p");o.textContent="id: "+e;var t=document.createElement("a");t.text="Download glyph_"+e.toUpperCase()+".png",t.classList=["downloadCanvas"],t.setAttribute("download","glyph_"+e.toUpperCase()+".png"),document.querySelector("#canvasmap").appendChild(n);let a=document.createElement("canvas");a.id="canvas"+e,a.width=1024,a.height=1024,a.style.border="1px solid",a.style.margin="0 auto",a.style.zoom="0.5",n.appendChild(o),n.appendChild(a),n.appendChild(t)}return document.querySelector("#canvas"+e)}String.prototype.hexEncode=function(){var e,t="";for(e=0;e<this.length;e++)t+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return t};var form=document.getElementById("uploadform");function processForm(e){e.preventDefault();let t=document.getElementById("inputfile");for(let e of t.files){let t=e.name.substring(0,1);console.log(t);let n=t.hexEncode(),o=n.substring(0,2),a=n.substring(2,3),i=n.substring(3,4);a.match(/[a-z]/i)&&(a=9+a.charCodeAt(0)-96),i.match(/[a-z]/i)&&(i=9+i.charCodeAt(0)-96),console.log(`horizontal: ${i}, vertical: ${a}`);let l=selectCanvas(o).getContext("2d"),s=new Image;s.src=URL.createObjectURL(e),s.onload=function(){let n=this.width/16;console.log(n);let o=this.height/n,s=this.width;console.log(`width: ${s}, height: ${o}`),storeFile(t,e),l.drawImage(this,0,0,s,this.height,64*i,64*a+Math.floor((64-4*o)/2),64,4*o)}}}function storeFile(e,t){let n=new FileReader;n.onloadend=function(){unicodeList[e]=n.result,updateList()},n.readAsDataURL(t)}function updateList(){let e=document.querySelector("#list ul");e.innerHTML="";for(let t in unicodeList){let n=unicodeList[t],o=document.createElement("li");o.innerHTML=`<span>${t}</span><img src="${n}">`,e.appendChild(o)}}form.attachEvent?form.attachEvent("submit",processForm):form.addEventListener("submit",processForm),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("downloadCanvas")){canvas=e.target.parentElement.querySelector("canvas");let t=document.getElementById("link");t.setAttribute("download",e.target.attributes.download.value),t.setAttribute("href",canvas.toDataURL("image/png").replace("image/png","image/octet-stream")),t.click()}});
